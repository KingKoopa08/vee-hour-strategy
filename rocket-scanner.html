<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 Rocket Scanner - Explosive Mover Detection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f3a 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Header */
        .header {
            background: rgba(20, 25, 45, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-bottom: 2px solid rgba(255, 100, 50, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(45deg, #ff6b35, #ff9558);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status-badges {
            display: flex;
            gap: 15px;
        }
        
        .badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .badge.active {
            background: rgba(50, 255, 50, 0.2);
            border: 1px solid #32ff32;
            color: #32ff32;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .tab {
            padding: 12px 24px;
            background: rgba(30, 35, 55, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab:hover {
            background: rgba(40, 45, 65, 0.6);
        }
        
        .tab.active {
            background: linear-gradient(135deg, rgba(255, 100, 50, 0.2), rgba(255, 50, 50, 0.1));
            border: 1px solid #ff6432;
            color: #ff6432;
        }
        
        /* Content Container */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 20px 20px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Filters Section */
        .filters {
            background: rgba(30, 35, 55, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
        }
        
        input, select {
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(20, 25, 45, 0.5);
            color: white;
            border-radius: 5px;
        }
        
        /* Alert Cards */
        .alerts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .category-section {
            margin-bottom: 40px;
        }
        
        .category-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 100, 50, 0.3);
            color: #ff9558;
        }
        
        .category-count {
            font-size: 14px;
            color: #888;
            font-weight: 400;
        }
        
        .alert-card {
            background: rgba(30, 35, 55, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s;
            animation: slideIn 0.5s ease;
            position: relative;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-card.jackpot {
            border: 2px solid #ff0000;
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(255, 50, 50, 0.05));
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
        }
        
        .alert-card.urgent {
            border: 2px solid #ff6432;
            background: linear-gradient(135deg, rgba(255, 100, 50, 0.1), rgba(255, 100, 50, 0.05));
        }
        
        .alert-card.alert {
            border: 2px solid #ffc832;
            background: linear-gradient(135deg, rgba(255, 200, 50, 0.1), rgba(255, 200, 50, 0.05));
        }
        
        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .stock-symbol {
            font-size: 20px;
            font-weight: 700;
        }
        
        .level-badge {
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .price-change {
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .positive { color: #32ff32; }
        .negative { color: #ff3232; }
        
        .alert-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }
        
        .stat-label {
            color: #888;
        }
        
        /* News Section */
        .news-container {
            display: grid;
            gap: 15px;
        }
        
        .news-item {
            background: rgba(30, 35, 55, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
        }
        
        .news-item:hover {
            background: rgba(40, 45, 65, 0.6);
            border-color: rgba(255, 100, 50, 0.5);
        }
        
        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .news-symbol {
            background: linear-gradient(135deg, #ff6432, #ff9558);
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: 600;
            font-size: 12px;
        }
        
        .news-time {
            color: #888;
            font-size: 11px;
        }
        
        .news-headline {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #fff;
        }
        
        .news-description {
            font-size: 13px;
            color: #aaa;
            line-height: 1.4;
        }
        
        .news-source {
            margin-top: 10px;
            font-size: 11px;
            color: #666;
        }
        
        /* Stats Panel */
        .stats-panel {
            background: rgba(30, 35, 55, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .stat-box {
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b35, #ff9558);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        
        /* Settings Panel */
        .settings-panel {
            background: rgba(30, 35, 55, 0.5);
            border-radius: 15px;
            padding: 20px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .setting-label {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: linear-gradient(45deg, #ff6b35, #ff9558);
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }
        
        /* News Indicator */
        .news-indicator {
            display: inline-block;
            margin-left: 8px;
            cursor: pointer;
            font-size: 16px;
            position: relative;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .news-indicator:hover .news-tooltip {
            display: block;
        }
        
        .news-tooltip {
            display: none;
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 25, 45, 0.98);
            border: 1px solid rgba(255, 100, 50, 0.5);
            border-radius: 8px;
            padding: 10px;
            width: 250px;
            z-index: 1000;
            font-size: 11px;
            color: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }
        
        .news-tooltip::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(20, 25, 45, 0.98);
        }
        
        /* News Modal */
        .news-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .news-modal.active {
            display: flex;
        }
        
        .news-modal-content {
            background: linear-gradient(135deg, rgba(20, 25, 45, 0.98), rgba(30, 35, 55, 0.98));
            border: 2px solid rgba(255, 100, 50, 0.5);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .news-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }
        
        .news-modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #ff6432;
        }
        
        .news-modal-close {
            font-size: 24px;
            cursor: pointer;
            color: #888;
            transition: color 0.3s;
        }
        
        .news-modal-close:hover {
            color: #ff6432;
        }
        
        .news-modal-body {
            color: #ddd;
            line-height: 1.6;
        }
        
        .news-modal-meta {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
            color: #888;
        }
        
        /* Disclaimer */
        .disclaimer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
            margin-top: 40px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            .alerts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="title-section">
                <div class="logo">🚀 ROCKET SCANNER</div>
                <div class="status-badges">
                    <div class="badge active" id="statusBadge">
                        <span class="status-dot">●</span>
                        <span id="marketStatus">SCANNING</span>
                    </div>
                    <div class="badge" id="timeBadge">
                        <span id="currentTime">00:00:00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('rockets')">🚀 Rockets</div>
        <div class="tab" onclick="switchTab('news')">📰 News Feed</div>
        <div class="tab" onclick="switchTab('settings')">⚙️ Settings</div>
    </div>

    <div class="container">
        <!-- Rockets Tab -->
        <div id="rockets-tab" class="tab-content active">
            <div class="stats-panel">
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="totalRockets">0</div>
                        <div class="stat-label">ROCKETS DETECTED</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="topGainer">-</div>
                        <div class="stat-label">TOP GAINER</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="topVolume">-</div>
                        <div class="stat-label">HIGHEST VOLUME</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="alertsToday">0</div>
                        <div class="stat-label">ALERTS TODAY</div>
                    </div>
                </div>
            </div>

            <div class="filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Min Change %</label>
                        <input type="number" id="minChange" value="10" step="5">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Min Volume</label>
                        <input type="number" id="minVolume" value="500000" step="100000">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Max Price</label>
                        <input type="number" id="maxPrice" value="100" step="10">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Alert Level</label>
                        <select id="alertLevel">
                            <option value="all">All Levels</option>
                            <option value="4">🚀 JACKPOT Only</option>
                            <option value="3">🔥 URGENT+</option>
                            <option value="2">⚡ ALERT+</option>
                            <option value="1">👀 ALL</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Category Sections -->
            <div id="categoryContainer">
                <!-- Momentum Leaders -->
                <div class="category-section" id="momentumLeadersSection">
                    <h2 class="category-title">🚀 MOMENTUM LEADERS <span class="category-count" id="leadersCount">(0)</span></h2>
                    <div class="alerts-grid" id="leadersContainer"></div>
                </div>
                
                <!-- Consolidating -->
                <div class="category-section" id="consolidatingSection">
                    <h2 class="category-title">⏸️ CONSOLIDATING <span class="category-count" id="consolidatingCount">(0)</span></h2>
                    <div class="alerts-grid" id="consolidatingContainer"></div>
                </div>
                
                <!-- Pullbacks -->
                <div class="category-section" id="pullbacksSection">
                    <h2 class="category-title">📉 PULLBACKS <span class="category-count" id="pullbacksCount">(0)</span></h2>
                    <div class="alerts-grid" id="pullbacksContainer"></div>
                </div>
                
                <div id="loadingMessage" style="text-align: center; padding: 40px; color: #888; display: none;">
                    <div style="font-size: 24px; margin-bottom: 10px;">🔍</div>
                    <div>Scanning for rockets...</div>
                </div>
            </div>
        </div>

        <!-- News Tab -->
        <div id="news-tab" class="tab-content">
            <div class="filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">News Source</label>
                        <select id="newsSource">
                            <option value="all">All Sources</option>
                            <option value="polygon">Polygon.io</option>
                            <option value="reddit">Reddit WSB</option>
                            <option value="stocktwits">StockTwits</option>
                            <option value="sec">SEC Filings</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Symbol Filter</label>
                        <input type="text" id="newsSymbol" placeholder="Enter symbol">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Time Range</label>
                        <select id="newsTimeRange">
                            <option value="1h">Last Hour</option>
                            <option value="4h">Last 4 Hours</option>
                            <option value="today">Today</option>
                            <option value="all">All</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="news-container" id="newsContainer">
                <!-- News items will be inserted here -->
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="settings-panel">
                <h3 style="margin-bottom: 20px;">Scanner Settings</h3>
                
                <div class="settings-grid">
                    <div class="setting-group">
                        <label class="setting-label">Sound Alerts</label>
                        <div class="toggle-switch" id="soundToggle" onclick="toggleSetting('sound')">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">Auto-Refresh</label>
                        <div class="toggle-switch active" id="autoRefreshToggle" onclick="toggleSetting('autoRefresh')">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">Scan Interval</label>
                        <select id="scanInterval">
                            <option value="30">30 seconds</option>
                            <option value="60">1 minute</option>
                            <option value="120">2 minutes</option>
                            <option value="300">5 minutes</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">Alert Threshold</label>
                        <select id="alertThreshold">
                            <option value="1">All Alerts</option>
                            <option value="2">Level 2+</option>
                            <option value="3">Level 3+</option>
                            <option value="4">Level 4 Only</option>
                        </select>
                    </div>
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 20px;">Alert Level Configuration</h3>
                
                <div class="settings-grid">
                    <div class="setting-group">
                        <label class="setting-label">Level 1 (WATCH) - Min Change %</label>
                        <input type="number" id="l1Change" value="5" step="1">
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Level 2 (ALERT) - Min Change %</label>
                        <input type="number" id="l2Change" value="15" step="5">
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Level 3 (URGENT) - Min Change %</label>
                        <input type="number" id="l3Change" value="50" step="10">
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Level 4 (JACKPOT) - Min Change %</label>
                        <input type="number" id="l4Change" value="100" step="25">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="disclaimer">
        ⚠️ This is not financial advice. Trading involves risk. Always do your own research.
    </div>
    
    <!-- News Modal -->
    <div id="newsModal" class="news-modal">
        <div class="news-modal-content">
            <div class="news-modal-header">
                <div class="news-modal-title" id="newsModalTitle">📰 Breaking News</div>
                <div class="news-modal-close" onclick="closeNewsModal()">×</div>
            </div>
            <div class="news-modal-body" id="newsModalBody">
                <!-- News content will be inserted here -->
            </div>
            <div class="news-modal-meta" id="newsModalMeta">
                <!-- Meta info will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = window.location.origin;
        // Determine WebSocket URL based on environment
        let WS_URL;
        if (window.location.hostname === 'localhost') {
            // Development: use separate port
            WS_URL = `ws://${window.location.hostname}:3006`;
        } else {
            // Production: use same port with /ws path
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            WS_URL = `${protocol}//${window.location.host}/ws`;
        }
        
        // State
        let rockets = new Map();
        let news = [];
        let scanInterval = null;
        let lastScanTime = 0;
        let settings = {
            sound: false,
            autoRefresh: true,
            scanInterval: 30000,  // Full scan every 30 seconds (real-time via WebSocket)
            alertThreshold: 1
        };
        
        // Initialize
        function init() {
            window.isFirstLoad = true;  // Prevent sound on initial load
            updateTime();
            setInterval(updateTime, 1000);
            loadSettings();
            startScanning();
            loadNews();
            connectWebSocket();
            
            // Allow sounds after initial load
            setTimeout(() => {
                window.isFirstLoad = false;
            }, 3000);
        }
        
        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('en-US', { hour12: false });
            
            // Update market status
            const marketSession = getMarketSession();
            document.getElementById('marketStatus').textContent = marketSession.status;
        }
        
        // Get market session
        function getMarketSession() {
            const now = new Date();
            const easternTime = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
            const hour = easternTime.getHours();
            const minute = easternTime.getMinutes();
            const day = easternTime.getDay();
            
            if (day === 0 || day === 6) {
                return { status: 'WEEKEND', color: '#666' };
            }
            
            const time = hour * 100 + minute;
            
            if (time >= 400 && time < 930) {
                return { status: 'PRE-MARKET', color: '#ffc832' };
            } else if (time >= 930 && time < 1600) {
                return { status: 'MARKET OPEN', color: '#32ff32' };
            } else if (time >= 1600 && time < 2000) {
                return { status: 'AFTER-HOURS', color: '#ff6432' };
            } else {
                return { status: 'CLOSED', color: '#666' };
            }
        }
        
        // WebSocket connection
        let ws = null;
        let reconnectTimer = null;
        
        function connectWebSocket() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                return;
            }
            
            ws = new WebSocket(WS_URL);
            
            ws.onopen = () => {
                console.log('🔌 WebSocket connected for real-time updates');
                if (reconnectTimer) {
                    clearTimeout(reconnectTimer);
                    reconnectTimer = null;
                }
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                
                if (data.type === 'priceUpdates') {
                    // Real-time price updates for individual stocks
                    console.log(`📈 Received price updates for ${data.data.length} stocks`);
                    // Debug: Log momentum data
                    const withMomentum = data.data.filter(d => d.priceChange1m !== 0 || d.priceChange5m !== 0);
                    if (withMomentum.length > 0) {
                        console.log('📊 Momentum data received:', withMomentum.map(d => 
                            `${d.symbol}: 1m=${d.priceChange1m?.toFixed(2)}%, 5m=${d.priceChange5m?.toFixed(2)}%`
                        ));
                    }
                    updateRealTimePrices(data.data);
                } else if (data.type === 'rocketsUpdate') {
                    // Full rockets categorization update - skip if we just did a scan
                    // This prevents the WebSocket update from overwriting the HTTP response
                    const timeSinceLastScan = Date.now() - lastScanTime;
                    if (timeSinceLastScan > 5000) {  // Only apply WebSocket updates if last scan was > 5 seconds ago
                        updateCategorizedRockets(data.data);
                    }
                } else if (data.type === 'rocket') {
                    addRocketAlert(data);
                } else if (data.type === 'news') {
                    addNewsItem(data);
                }
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
            
            ws.onclose = () => {
                console.log('WebSocket disconnected, reconnecting in 3 seconds...');
                reconnectTimer = setTimeout(connectWebSocket, 3000);
            };
        }
        
        // Update real-time prices for specific stocks
        function updateRealTimePrices(priceUpdates) {
            let updatedCount = 0;
            for (const update of priceUpdates) {
                // Update all tiles with this symbol
                const tiles = document.querySelectorAll(`.rocket-tile[data-symbol="${update.symbol}"]`);
                
                if (tiles.length === 0) {
                    // Tile doesn't exist yet, skip
                    continue;
                }
                
                tiles.forEach(tile => {
                    updatedCount++;
                    
                    // Update price
                    const priceElement = tile.querySelector('.rocket-price');
                    if (priceElement) {
                        const oldPrice = priceElement.textContent;
                        priceElement.textContent = `$${update.price.toFixed(2)}`;
                        
                        // Add price direction indicator
                        if (oldPrice !== priceElement.textContent) {
                            priceElement.style.color = update.price > parseFloat(oldPrice.replace('$', '')) ? '#32ff32' : '#ff3232';
                            setTimeout(() => {
                                priceElement.style.color = '';
                            }, 500);
                        }
                    }
                    
                    // Update day change
                    const dayChangeElement = tile.querySelector('.rocket-change, .price-change');
                    if (dayChangeElement) {
                        const percentText = `${update.changePercent >= 0 ? '+' : ''}${update.changePercent.toFixed(1)}%`;
                        // Only update the percentage text, not the entire element
                        const textNode = Array.from(dayChangeElement.childNodes).find(node => node.nodeType === 3);
                        if (textNode) {
                            textNode.textContent = percentText;
                        } else {
                            // If no text node, update the first part of innerHTML
                            const currentHTML = dayChangeElement.innerHTML;
                            dayChangeElement.innerHTML = percentText + currentHTML.substring(currentHTML.indexOf('<') > -1 ? currentHTML.indexOf('<') : currentHTML.length);
                        }
                        dayChangeElement.classList.toggle('positive', update.changePercent >= 0);
                        dayChangeElement.classList.toggle('negative', update.changePercent < 0);
                    }
                    
                    // Update 1m momentum - only if we have valid data
                    const momentum1mElement = tile.querySelector('.momentum-1m');
                    if (momentum1mElement && update.priceChange1m !== undefined && update.priceChange1m !== null) {
                        momentum1mElement.textContent = `1m: ${update.priceChange1m >= 0 ? '+' : ''}${update.priceChange1m.toFixed(1)}%`;
                        momentum1mElement.classList.toggle('positive', update.priceChange1m >= 0);
                        momentum1mElement.classList.toggle('negative', update.priceChange1m < 0);
                    }
                    // Don't clear momentum if no data provided
                    
                    // Update 5m momentum - only if we have valid data
                    const momentum5mElement = tile.querySelector('.momentum-5m');
                    if (momentum5mElement && update.priceChange5m !== undefined && update.priceChange5m !== null) {
                        momentum5mElement.textContent = `5m: ${update.priceChange5m >= 0 ? '+' : ''}${update.priceChange5m.toFixed(1)}%`;
                        momentum5mElement.classList.toggle('positive', update.priceChange5m >= 0);
                        momentum5mElement.classList.toggle('negative', update.priceChange5m < 0);
                    }
                    // Don't clear momentum if no data provided
                    
                    // Update volume if changed significantly
                    const volumeElement = tile.querySelector('.rocket-volume');
                    if (volumeElement && update.volume) {
                        volumeElement.textContent = `${(update.volume / 1000000).toFixed(1)}M`;
                    }
                    
                    // Add a subtle animation to show the update
                    tile.style.transition = 'background-color 0.3s';
                    tile.style.backgroundColor = update.priceChange1m > 0 ? 'rgba(0, 255, 0, 0.05)' : 'rgba(255, 0, 0, 0.05)';
                    setTimeout(() => {
                        tile.style.backgroundColor = '';
                    }, 300);
                });
            }
            
            if (updatedCount > 0) {
                console.log(`✅ Updated ${updatedCount} tiles with real-time prices`);
            }
        }
        
        // Start scanning
        function startScanning() {
            scanForRockets();
            
            if (settings.autoRefresh) {
                scanInterval = setInterval(scanForRockets, settings.scanInterval);
            }
        }
        
        // Scan for rockets
        async function scanForRockets() {
            try {
                lastScanTime = Date.now();  // Track when we last scanned
                console.log('Scanning for rockets...');
                console.log('API URL:', `${API_URL}/api/rockets/scan`);
                
                // First try rocket scan endpoint
                const response = await fetch(`${API_URL}/api/rockets/scan`);
                console.log('Response status:', response.status);
                
                const data = await response.json();
                console.log('Data received:', data);
                
                if (data.success && data.rockets) {
                    // Handle categorized rockets
                    if (data.rockets.momentumLeaders || data.rockets.consolidating || data.rockets.pullbacks) {
                        console.log('Updating categorized rockets');
                        console.log('Leaders:', data.rockets.momentumLeaders?.length || 0);
                        console.log('Consolidating:', data.rockets.consolidating?.length || 0);
                        console.log('Pullbacks:', data.rockets.pullbacks?.length || 0);
                        updateCategorizedRockets(data.rockets);
                    } else if (Array.isArray(data.rockets) && data.rockets.length > 0) {
                        // Fallback for old format
                        console.log('Using legacy format with', data.rockets.length, 'rockets');
                        updateRockets(data.rockets);
                    } else {
                        console.log('No rockets in expected format');
                        updateCategorizedRockets({ momentumLeaders: [], consolidating: [], pullbacks: [] });
                    }
                } else {
                    console.log('No success or no rockets in response');
                    // Fallback to top volume stocks if no rockets
                    const volumeResponse = await fetch(`${API_URL}/api/stocks/top-volume`);
                    const volumeData = await volumeResponse.json();
                    
                    if (volumeData.success && volumeData.stocks) {
                        // Filter for potential rockets
                        const potentialRockets = volumeData.stocks.filter(stock => 
                            Math.abs(stock.priceChangePercent) >= 10 || stock.volume >= 1000000
                        );
                        
                        // Add level based on change percentage
                        potentialRockets.forEach(stock => {
                            const change = Math.abs(stock.priceChangePercent);
                            if (change >= 75) stock.level = 4;
                            else if (change >= 30) stock.level = 3;
                            else if (change >= 15) stock.level = 2;
                            else stock.level = 1;
                        });
                        
                        updateRockets(potentialRockets);
                    }
                }
            } catch (error) {
                console.error('Scan error:', error);
            }
        }
        
        // Format volume for display
        function formatVolume(volume) {
            if (volume >= 1000000) {
                return (volume / 1000000).toFixed(1) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(0) + 'K';
            }
            return volume.toString();
        }
        
        // Update categorized rockets display
        function updateCategorizedRockets(categorizedData) {
            console.log('updateCategorizedRockets called with:', categorizedData);
            
            // Check if elements exist
            const leadersContainer = document.getElementById('leadersContainer');
            const consolidatingContainer = document.getElementById('consolidatingContainer');
            const pullbacksContainer = document.getElementById('pullbacksContainer');
            const loadingMessage = document.getElementById('loadingMessage');
            
            if (!leadersContainer || !consolidatingContainer || !pullbacksContainer) {
                console.error('Missing container elements!');
                console.log('leadersContainer:', leadersContainer);
                console.log('consolidatingContainer:', consolidatingContainer);
                console.log('pullbacksContainer:', pullbacksContainer);
                return;
            }
            
            // Clear all containers
            leadersContainer.innerHTML = '';
            consolidatingContainer.innerHTML = '';
            pullbacksContainer.innerHTML = '';
            if (loadingMessage) {
                loadingMessage.style.display = 'none';
            }
            
            let topGainerRef = { value: null };
            let topVolumeRef = { value: null };
            let totalCount = 0;
            
            // Update Momentum Leaders
            const leaders = categorizedData.momentumLeaders || [];
            document.getElementById('leadersCount').textContent = `(${leaders.length})`;
            leaders.forEach(rocket => {
                // Normalize field names
                if (rocket.priceChangePercent !== undefined && rocket.changePercent === undefined) {
                    rocket.changePercent = rocket.priceChangePercent;
                }
                addRocketCardToContainer(rocket, 'leadersContainer');
                updateTopStats(rocket, topGainerRef, topVolumeRef);
            });
            totalCount += leaders.length;
            
            // Update Consolidating
            const consolidating = categorizedData.consolidating || [];
            document.getElementById('consolidatingCount').textContent = `(${consolidating.length})`;
            consolidating.forEach(rocket => {
                // Normalize field names
                if (rocket.priceChangePercent !== undefined && rocket.changePercent === undefined) {
                    rocket.changePercent = rocket.priceChangePercent;
                }
                addRocketCardToContainer(rocket, 'consolidatingContainer');
                updateTopStats(rocket, topGainerRef, topVolumeRef);
            });
            totalCount += consolidating.length;
            
            // Update Pullbacks
            const pullbacks = categorizedData.pullbacks || [];
            document.getElementById('pullbacksCount').textContent = `(${pullbacks.length})`;
            pullbacks.forEach(rocket => {
                // Normalize field names
                if (rocket.priceChangePercent !== undefined && rocket.changePercent === undefined) {
                    rocket.changePercent = rocket.priceChangePercent;
                }
                addRocketCardToContainer(rocket, 'pullbacksContainer');
                updateTopStats(rocket, topGainerRef, topVolumeRef);
            });
            totalCount += pullbacks.length;
            
            // Update total count
            document.getElementById('totalRockets').textContent = totalCount;
            
            // Hide empty sections and display non-empty ones
            document.getElementById('momentumLeadersSection').style.display = leaders.length > 0 ? 'block' : 'none';
            document.getElementById('consolidatingSection').style.display = consolidating.length > 0 ? 'block' : 'none';
            document.getElementById('pullbacksSection').style.display = pullbacks.length > 0 ? 'block' : 'none';
            
            // Show message if no rockets found
            if (totalCount === 0) {
                document.getElementById('loadingMessage').innerHTML = '<div style="font-size: 24px; margin-bottom: 10px;">📭</div><div>No rockets detected yet. Waiting for market movers...</div>';
                document.getElementById('loadingMessage').style.display = 'block';
            }
        }
        
        function updateTopStats(rocket, topGainerRef, topVolumeRef) {
            if (!topGainerRef.value || Math.abs(rocket.changePercent) > Math.abs(topGainerRef.value.changePercent)) {
                topGainerRef.value = rocket;
                document.getElementById('topGainer').textContent = 
                    `${rocket.symbol} ${rocket.changePercent >= 0 ? '+' : ''}${rocket.changePercent.toFixed(1)}%`;
            }
            
            if (!topVolumeRef.value || rocket.volume > topVolumeRef.value.volume) {
                topVolumeRef.value = rocket;
                document.getElementById('topVolume').textContent = 
                    `${rocket.symbol} ${formatVolume(rocket.volume)}`;
            }
            
            return { topGainer: topGainerRef.value, topVolume: topVolumeRef.value };
        }
        
        // Update rockets display (legacy)
        function updateRockets(rocketsList) {
            // Convert to categorized format and use new function
            const categorized = {
                momentumLeaders: [],
                consolidating: [],
                pullbacks: []
            };
            
            rocketsList.forEach(rocket => {
                // Normalize field names
                if (rocket.priceChangePercent !== undefined && rocket.changePercent === undefined) {
                    rocket.changePercent = rocket.priceChangePercent;
                }
                
                // Categorize based on momentum if available, otherwise use smart defaults
                const priceChange1m = rocket.momentum?.priceChange1m;
                const priceChange5m = rocket.momentum?.priceChange5m;
                const dayChange = rocket.changePercent || 0;
                
                // Check if we have valid momentum data (not just 0)
                const hasMomentumData = priceChange1m !== undefined && priceChange1m !== null && Math.abs(priceChange1m) > 0.01;
                
                if (hasMomentumData) {
                    // Use precise momentum-based categorization
                    if (priceChange1m > 0.1 && (!priceChange5m || priceChange5m > 0)) {
                        categorized.momentumLeaders.push(rocket);
                    } else if (priceChange1m < -0.1) {
                        categorized.pullbacks.push(rocket);
                    } else {
                        categorized.consolidating.push(rocket);
                    }
                } else {
                    // Smart initial categorization based on overall performance
                    // This provides immediate categorization while waiting for momentum data
                    
                    if (dayChange >= 50) {
                        // Extreme gainers (50%+) are momentum leaders
                        categorized.momentumLeaders.push(rocket);
                    } else if (dayChange >= 25) {
                        // Strong gainers (25-50%) - check volume for categorization
                        if (rocket.volume > 5000000 || rocket.level >= 3) {
                            categorized.momentumLeaders.push(rocket);
                        } else {
                            categorized.consolidating.push(rocket);
                        }
                    } else if (dayChange >= 15) {
                        // Moderate gainers (15-25%) - likely consolidating unless high volume
                        if (rocket.volume > 10000000 && rocket.level >= 2) {
                            categorized.momentumLeaders.push(rocket);
                        } else {
                            categorized.consolidating.push(rocket);
                        }
                    } else if (dayChange >= 10) {
                        // Small gainers go to consolidating
                        categorized.consolidating.push(rocket);
                    } else if (dayChange <= -5) {
                        // Clear losers are pullbacks
                        categorized.pullbacks.push(rocket);
                    } else {
                        // Everything else consolidating
                        categorized.consolidating.push(rocket);
                    }
                }
            });
            
            // Sort each category appropriately
            categorized.momentumLeaders.sort((a, b) => (b.changePercent || 0) - (a.changePercent || 0));
            categorized.consolidating.sort((a, b) => (b.volume || 0) - (a.volume || 0));
            categorized.pullbacks.sort((a, b) => (a.changePercent || 0) - (b.changePercent || 0));
            
            updateCategorizedRockets(categorized);
        }
        
        // Check if rocket should be shown based on filters
        function shouldShowRocket(rocket) {
            const minChange = parseFloat(document.getElementById('minChange').value);
            const minVolume = parseFloat(document.getElementById('minVolume').value);
            const maxPrice = parseFloat(document.getElementById('maxPrice').value);
            const alertLevel = document.getElementById('alertLevel').value;
            
            const changePercent = Math.abs(rocket.changePercent || rocket.priceChangePercent || 0);
            
            if (changePercent < minChange) return false;
            if (rocket.volume < minVolume) return false;
            if (rocket.price > maxPrice) return false;
            if (alertLevel !== 'all' && rocket.level && rocket.level < parseInt(alertLevel)) return false;
            
            return true;
        }
        
        // Add rocket card
        function addRocketCardToContainer(rocket, containerId) {
            const container = document.getElementById(containerId);
            _createRocketCard(rocket, container);
        }
        
        function addRocketCard(rocket) {
            const container = document.getElementById('alertsContainer');
            _createRocketCard(rocket, container);
        }
        
        function _createRocketCard(rocket, container) {
            
            // Get change percentage (handle both field names)
            const changePercent = rocket.changePercent || rocket.priceChangePercent || 0;
            
            const levelClass = rocket.level === 4 ? 'jackpot' : 
                              rocket.level === 3 ? 'urgent' : 
                              rocket.level === 2 ? 'alert' : '';
            
            const levelEmoji = rocket.level === 4 ? '🚀 JACKPOT' :
                              rocket.level === 3 ? '🔥 URGENT' :
                              rocket.level === 2 ? '⚡ ALERT' :
                              '👀 WATCH';
            
            // Create news indicator if news exists
            const newsIndicator = rocket.news ? `
                <span class="news-indicator" onclick="showNewsModal('${rocket.symbol}', \`${rocket.news.replace(/'/g, "\\'").replace(/`/g, "\\`")}\`, \`${(rocket.newsDescription || '').replace(/'/g, "\\'").replace(/`/g, "\\`")}\`, '${rocket.newsSource || ''}', '${rocket.newsTime || ''}')">
                    📰
                    <div class="news-tooltip">
                        <strong>${rocket.news.substring(0, 50)}...</strong>
                        <br><br>
                        Click to read full article
                    </div>
                </span>
            ` : '';
            
            // Get momentum indicator (only show if we have data)
            const momentumIndicator = rocket.trend ? rocket.trend : '';
            const momentumColor = rocket.direction === 'up' ? '#32ff32' : 
                                 rocket.direction === 'down' ? '#ff3232' : 
                                 rocket.direction === 'unknown' ? '#666' : '#888';
            const isAccelerating = rocket.accelerating ? '⚡' : '';
            
            // Show 5-minute change if available (grey color)
            const trend5min = (rocket.momentum && rocket.momentum.priceChange5m !== undefined && rocket.momentum.priceChange5m !== null) ? 
                `<span style="font-size: 11px; color: #888; margin-left: 8px; padding: 2px 6px; background: rgba(255,255,255,0.05); border-radius: 3px; border: 1px solid rgba(255,255,255,0.1);">
                    5m: ${rocket.momentum.priceChange5m >= 0 ? '+' : ''}${rocket.momentum.priceChange5m.toFixed(1)}%
                </span>` : '';
            
            // Show warning if momentum is unknown or if using shorter timeframe
            const momentumWarning = (!rocket.trend && rocket.changePercent > 0) ? 
                '<span style="font-size: 10px; color: #888; margin-left: 5px;">(no history)</span>' : 
                (rocket.momentum && rocket.momentum.trendPeriod && rocket.momentum.trendPeriod !== '5m') ?
                `<span style="font-size: 10px; color: #888; margin-left: 5px;">(${rocket.momentum.trendPeriod})</span>` : '';
            
            // Add gap indicator
            const gapIndicator = rocket.gap ? `
                <span style="font-size: 14px; margin-left: 8px; padding: 2px 6px; background: ${rocket.gap.type === 'GAP_UP' ? 'rgba(0,255,0,0.2)' : 'rgba(255,0,0,0.2)'}; border: 1px solid ${rocket.gap.type === 'GAP_UP' ? '#00ff00' : '#ff0000'}; border-radius: 4px;">
                    ${rocket.gap.type === 'GAP_UP' ? '📈' : '📉'} ${rocket.gap.type === 'GAP_UP' ? 'GAP UP' : 'GAP DOWN'} ${rocket.gap.percent.toFixed(1)}%
                </span>
            ` : '';
            
            // Add ORB indicator
            const orbIndicator = rocket.orbSignal ? `
                <span style="font-size: 14px; margin-left: 8px; padding: 2px 6px; background: ${rocket.orbSignal.type === 'BREAKOUT_UP' ? 'rgba(255,200,0,0.2)' : 'rgba(255,0,100,0.2)'}; border: 1px solid ${rocket.orbSignal.type === 'BREAKOUT_UP' ? '#ffc800' : '#ff0064'}; border-radius: 4px;">
                    ${rocket.orbSignal.type === 'BREAKOUT_UP' ? '🎯' : '❌'} ORB ${rocket.orbSignal.type === 'BREAKOUT_UP' ? 'BREAK' : 'BREAKDOWN'}
                </span>
            ` : '';
            
            const card = document.createElement('div');
            card.className = `alert-card rocket-tile ${levelClass}`;
            card.setAttribute('data-symbol', rocket.symbol);
            card.innerHTML = `
                <div class="alert-header">
                    <div class="stock-symbol">
                        ${rocket.symbol}
                        ${momentumIndicator ? `<span style="font-size: 20px; color: ${momentumColor}; margin-left: 5px;">${momentumIndicator}</span>` : ''}
                        ${isAccelerating}
                        ${trend5min ? `<span class="momentum-5m ${rocket.momentum && rocket.momentum.priceChange5m >= 0 ? 'positive' : 'negative'}" style="font-size: 11px; color: #888; margin-left: 8px; padding: 2px 6px; background: rgba(255,255,255,0.05); border-radius: 3px; border: 1px solid rgba(255,255,255,0.1);">
                            5m: ${rocket.momentum && rocket.momentum.priceChange5m >= 0 ? '+' : ''}${rocket.momentum && rocket.momentum.priceChange5m !== null ? rocket.momentum.priceChange5m.toFixed(1) : '0.0'}%
                        </span>` : ''}
                        ${momentumWarning}
                        ${newsIndicator}
                        ${gapIndicator}
                        ${orbIndicator}
                    </div>
                    <div class="level-badge">${levelEmoji}</div>
                </div>
                <div class="price-change rocket-change ${changePercent > 0 ? 'positive' : 'negative'}">
                    ${changePercent > 0 ? '+' : ''}${changePercent.toFixed(1)}%
                    ${rocket.momentum && rocket.momentum.priceChange1m !== undefined && rocket.momentum.priceChange1m !== null && rocket.momentum.priceChange1m !== 0 ? 
                        `<span class="momentum-1m ${rocket.momentum.priceChange1m > 0 ? 'positive' : 'negative'}" style="font-size: 12px; color: ${rocket.momentum.priceChange1m > 0 ? '#32ff32' : '#ff3232'}; margin-left: 10px; padding: 2px 6px; background: rgba(0,0,0,0.3); border-radius: 3px; font-weight: 500;">
                            1m: ${rocket.momentum.priceChange1m > 0 ? '+' : ''}${rocket.momentum.priceChange1m.toFixed(1)}%
                        </span>` 
                        : ''}
                </div>
                <div class="alert-stats">
                    <div class="stat">
                        <span class="stat-label">Price</span>
                        <span class="rocket-price">$${rocket.price.toFixed(2)}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Volume</span>
                        <span class="rocket-volume">${(rocket.volume / 1000000).toFixed(1)}M</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">VWAP</span>
                        <span>$${(rocket.vwap || rocket.price).toFixed(2)}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Session</span>
                        <span>${rocket.session || 'regular'}</span>
                    </div>
                </div>
            `;
            
            container.appendChild(card);
            
            // Play sound if enabled (but not on first page load)
            if (settings.sound && rocket.level >= settings.alertThreshold && !window.isFirstLoad) {
                playAlertSound();
            }
        }
        
        // Load news
        async function loadNews() {
            try {
                const response = await fetch(`${API_URL}/api/news/breaking`);
                const data = await response.json();
                
                if (data.success && data.news) {
                    updateNews(data.news);
                }
            } catch (error) {
                console.error('News error:', error);
            }
        }
        
        // Update news display
        function updateNews(newsList) {
            const container = document.getElementById('newsContainer');
            container.innerHTML = '';
            
            newsList.forEach(item => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';
                newsItem.innerHTML = `
                    <div class="news-header">
                        <div class="news-symbol">${item.symbol || 'MARKET'}</div>
                        <div class="news-time">${formatTime(item.timestamp)}</div>
                    </div>
                    <div class="news-headline">${item.headline}</div>
                    ${item.description ? `<div class="news-description">${item.description}</div>` : ''}
                    <div class="news-source">Source: ${item.source || 'Unknown'}</div>
                `;
                container.appendChild(newsItem);
            });
        }
        
        // Format time
        function formatTime(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            return date.toLocaleDateString();
        }
        
        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Load data for tab
            if (tabName === 'news') {
                loadNews();
            }
        }
        
        // Toggle setting
        function toggleSetting(setting) {
            const toggle = document.getElementById(`${setting}Toggle`);
            toggle.classList.toggle('active');
            settings[setting] = toggle.classList.contains('active');
            
            if (setting === 'autoRefresh') {
                if (settings.autoRefresh) {
                    startScanning();
                } else {
                    clearInterval(scanInterval);
                }
            }
            
            saveSettings();
        }
        
        // Load settings
        function loadSettings() {
            const saved = localStorage.getItem('rocketScannerSettings');
            if (saved) {
                settings = JSON.parse(saved);
                
                // Apply settings to UI
                document.getElementById('soundToggle').classList.toggle('active', settings.sound);
                document.getElementById('autoRefreshToggle').classList.toggle('active', settings.autoRefresh);
            }
        }
        
        // Save settings
        function saveSettings() {
            localStorage.setItem('rocketScannerSettings', JSON.stringify(settings));
        }
        
        // Play alert sound
        function playAlertSound() {
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRmAFAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoFAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+zPDaizsIGGS57OScTgwNTKvm7blmFgU2jdXy0Hww');
                audio.volume = 0.5;
                audio.play().catch(e => {
                    // Silently ignore autoplay errors
                    console.log('Audio autoplay prevented by browser');
                });
            } catch (e) {
                // Silently handle any audio errors
            }
        }
        
        // Show news modal
        function showNewsModal(symbol, headline, description, source, timestamp) {
            const modal = document.getElementById('newsModal');
            const titleEl = document.getElementById('newsModalTitle');
            const bodyEl = document.getElementById('newsModalBody');
            const metaEl = document.getElementById('newsModalMeta');
            
            titleEl.innerHTML = `📰 ${symbol} - Breaking News`;
            
            bodyEl.innerHTML = `
                <h3 style="color: #ff6432; margin-bottom: 15px;">${headline}</h3>
                ${description ? `<p>${description}</p>` : '<p style="color: #888;">Full article content not available. Click source to read more.</p>'}
            `;
            
            const timeStr = timestamp ? formatTime(new Date(timestamp)) : 'Unknown';
            metaEl.innerHTML = `
                <span><strong>Source:</strong> ${source || 'Unknown'}</span>
                <span><strong>Published:</strong> ${timeStr}</span>
            `;
            
            modal.classList.add('active');
        }
        
        // Close news modal
        function closeNewsModal() {
            const modal = document.getElementById('newsModal');
            modal.classList.remove('active');
        }
        
        // Close modal on outside click
        document.getElementById('newsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeNewsModal();
            }
        });
        
        // Close modal on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeNewsModal();
            }
        });
        
        // Start the application
        init();
    </script>
</body>
</html>